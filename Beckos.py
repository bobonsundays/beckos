
# =============================================================================
# Beckos 2.0 MoV-weighted Elo system
# by Bob
# 
# README
# 
# The code is currently populated with data from S47, so that running the code processes the most recent list of games from S48.
# f and g need to point to the current JSONs of getteamscsv and getmatchescsv, respectively.
# 
# - lastEndDate is set to a date before the start of the season to handle a whole season at a time. For a weekly update, this variable will need to be manually updated.
# - Similarly for the ratings list: the ratings variable will need to be pasted over after running the code in order to provide the most recent ratings for the next iteration.
# - oldMov will only have to be manually updated after season rollover.
# - The useful outputs are:
#     - regions and SCDivisions: aggregate region/division ratings
#     - names: the names data JSON obtained from RZA, with appends
#     - games: the games data JSON obtained from RZA, with appends
# =============================================================================

import datetime
import json
import math
from bisect import bisect
import random

f = open('c:/Users/Ian/Desktop/rzajson.json')
names = json.load(f)

g = open('c:/Users/Ian/Desktop/rza49json.json')
games = json.load(g)



# =============================================================================
# typeDb = [1:'League', 7:'Supercup', 5:'Champ of Champs', 
#           8:'Supercup Playoffs', 10:'Wildcard Playoff', 
#           11: 'Divisional Playoff', 12: 'Conference Championship', 
#           14: 'Relegation', 13: 'Bowl', 9:'Global Bowl', 
#           6:'Champ of Champs Bowl']
# =============================================================================


# specify the most recent gamedate that was included in last update
lastEndDate = datetime.date(2001, 8, 26)

# specify past seasons' weighted average of MoV distribution
oldMov = [0.5111808899046515, 0.5187299985144107, 0.5377282081230271, 0.5522960863866588, 0.5601073228580984, 0.5751605333046461, 0.5920659737087263, 0.6004577243697404, 0.6092949689014173, 0.6260611352976778, 0.64095256834992, 0.6479938413902773, 0.6604412786021702, 0.6752436128802799, 0.6811074373875287, 0.6875906996247974, 0.7006186510262641, 0.711286536900797, 0.7198841569572786, 0.7316619812054644, 0.7406445829774871, 0.7471616002944834, 0.7558544023576232, 0.7674427773643008, 0.7754547147704913, 0.7807717801678934, 0.7902120422756302, 0.7987318152512223, 0.8052150774884902, 0.8124068762299106, 0.8220867628128431, 0.8287205507511738, 0.8333403313376672, 0.8407328310138379, 0.8496877609386585, 0.8553283811246717, 0.8614041582599138, 0.8677368947961193, 0.8727079020184254, 0.8770543030499958, 0.8851389190763582, 0.8911870243643981, 0.8939320716068737, 0.8997569725736776, 0.9061009608031255, 0.9096548950171283, 0.9131811573839281, 0.9193572849865456, 0.923368879536262, 0.9255169924352032, 0.9288814774076974, 0.9342487180387876, 0.9368821631206455, 0.9400121920786617, 0.9438896810812749, 0.9475050422222077, 0.9499429548300317, 0.9513600278383357, 0.9555835750160449, 1.0]


typeDbOfficial = [1, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14]


# =============================================================================
# # build dummy ratings
# ratings2 = []
# for i in range(0,1824):
#     ratings2.append(100)
# =============================================================================

ratings = [41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 390.60391096633253, 41.46003688575821, 627.3152876612048, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 242.95957598787533, 41.46003688575821, 41.46003688575821, 41.46003688575821, 263.24399451982345, 41.46003688575821, 41.46003688575821, 97.57951067635489, 550.4224161677023, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 338.3177928773254, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 506.50261212591465, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 466.0611110933625, 41.46003688575821, 41.46003688575821, 707.4004238012338, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 47.62225959097994, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 737.0291471919746, 41.46003688575821, 41.46003688575821, 574.7118393378621, 41.46003688575821, 563.8863642664054, 695.2706899666272, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 669.3167880047556, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 729.9686930323057, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 702.150306573568, 41.46003688575821, 616.5885833676925, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 663.2179498500442, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 525.350023885172, 41.46003688575821, 41.46003688575821, 41.46003688575821, 601.9243927799683, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 348.32976733082376, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 537.0958255684214, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 571.5530719091097, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 593.3218345652027, 41.46003688575821, 324.5105258772091, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 678.462554218928, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 344.2283227583822, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 585.3132877087096, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 725.1167734785028, 41.46003688575821, 715.6729727016656, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 710.0338179835566, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 243.85362453754175, 41.46003688575821, 41.46003688575821, 41.46003688575821, 376.9000436770388, 618.5322826620397, 41.46003688575821, 41.46003688575821, 51.85795363559581, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 693.9692971534727, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 40.425739802412956, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 577.4267149744668, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 592.5981023013879, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 537.8208910786242, 615.5592545895378, 670.4065742476313, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 355.56852383400866, 41.46003688575821, 41.46003688575821, 41.46003688575821, 190.15175057533895, 41.46003688575821, 41.46003688575821, 458.0646974570682, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.160356909527636, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 375.2103738337062, 674.1745485035833, 633.5777627692378, 41.46003688575821, 41.46003688575821, 706.5300234766761, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 368.80536762038105, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 289.39707449709095, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 286.7327711332547, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 672.5702039604208, 41.46003688575821, 52.82663651261107, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 689.9282156972677, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 329.9515710678795, 41.46003688575821, 41.46003688575821, 665.6598919851706, 759.5673119431268, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 624.2742663036348, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 645.2344769403696, 41.46003688575821, 41.46003688575821, 715.4499140545164, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 412.932220087835, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 145.65710526386616, 41.46003688575821, 41.46003688575821, 41.46003688575821, 155.04542728090448, 41.46003688575821, 585.5466379499265, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 723.5859646886843, 41.46003688575821, 41.46003688575821, 676.1799955251541, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 308.27622144015976, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 198.39895420631942, 41.46003688575821, 41.46003688575821, 41.46003688575821, 430.1308790239851, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 608.4498783065985, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 684.9272349301415, 709.9380140990312, 677.4551386751917, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 385.9315083838077, 41.46003688575821, 41.46003688575821, 41.46003688575821, 591.3807591854265, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 743.1840453486446, 41.46003688575821, 41.46003688575821, 491.67813841205015, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 83.92376397818802, 41.46003688575821, 557.1430836269237, 460.39752200916183, 41.46003688575821, 41.46003688575821, 653.5066343229707, 432.3696778179304, 679.0968268993811, 41.46003688575821, 641.2502638378669, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 253.21503764848833, 41.46003688575821, 41.46003688575821, 41.46003688575821, 629.149320222715, 617.2916649242177, 41.46003688575821, 41.46003688575821, 41.46003688575821, 382.9498338894183, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 687.3777498588679, 609.0174572065482, 650.7599692506033, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 605.7095076853041, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 653.1842341894031, 656.9413361472592, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 697.1053411905408, 41.46003688575821, 631.1208244519225, 620.9569736696591, 41.46003688575821, 41.46003688575821, 104.70225226883602, 41.46003688575821, 387.4192029811529, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 637.5747323199608, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 621.8431376063811, 41.46003688575821, 570.8755680826057, 41.46003688575821, 681.4749406085854, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 595.10843727485, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 91.24572065230501, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 569.3455599330189, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 59.88588230109929, 385.1244035634188, 41.46003688575821, 41.46003688575821, 41.46003688575821, 269.2841866695749, 612.7525221918238, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 663.7820088410682, 175.57597005447815, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 39.20479579215949, 41.46003688575821, 235.73625269662207, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 156.49732046506097, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 348.5504963373795, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 744.131103925707, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 338.6257698740765, 41.46003688575821, 41.46003688575821, 41.46003688575821, 607.0664784045625, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 601.228769781281, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 43.71527797935693, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 706.1152766789867, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 452.38931217395253, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 537.5751036001517, 41.46003688575821, 41.46003688575821, 41.46003688575821, 660.5616125744361, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 639.0928787200652, 41.46003688575821, 41.46003688575821, 41.46003688575821, 39.44305872099536, 607.524335711091, 263.960213845308, 41.46003688575821, 410.20161185066877, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 469.3394427991282, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 317.05883588418766, 41.46003688575821, 41.46003688575821, 41.46003688575821, 290.78106801134214, 41.46003688575821, 41.46003688575821, 550.5085372854619, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 675.3065553321019, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 123.62960038366876, 41.46003688575821, 41.46003688575821, 336.22592973699716, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 729.8678501488841, 41.46003688575821, 488.9765943023118, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 370.01187681832414, 41.46003688575821, 41.46003688575821, 546.3940892109238, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 492.5553998510085, 392.50663497321864, 41.46003688575821, 41.46003688575821, 41.46003688575821, 274.56416557844267, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 40.54351799469576, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 229.30714116109672, 41.46003688575821, 41.46003688575821, 694.7443411246135, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 628.5901191927531, 41.46003688575821, 41.46003688575821, 476.4685768844491, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 571.5965349980225, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 38.65613907967373, 41.46003688575821, 496.75323828361905, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 695.8054557587712, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 669.5347636756221, 41.46003688575821, 41.46003688575821, 23.936398412846806, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 327.6303329103054, 41.46003688575821, 41.46003688575821, 41.46003688575821, 305.29174085335353, 41.46003688575821, 41.46003688575821, 41.46003688575821, 667.3550446604464, 266.9412162213527, 41.46003688575821, 425.70724053336255, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 665.0819086796976, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 395.5814176204697, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 574.2706067748001, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 487.76925528250126, 641.3267713195843, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 516.7024328718068, 41.46003688575821, 41.46003688575821, 41.46003688575821, 107.2627268837619, 670.9058678884971, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 646.4005622905493, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 643.7377676498331, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 706.9767873238409, 41.46003688575821, 585.7493480021607, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 356.9670277785821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 594.876624203005, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 529.4132510419885, 41.46003688575821, 41.46003688575821, 41.46003688575821, 631.5727985051843, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 622.2373889742564, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 740.4907488164599, 41.46003688575821, 41.46003688575821, 468.9313023928349, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 641.7117417088022, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 582.1926181582593, 41.46003688575821, 246.48227361261567, 41.46003688575821, 41.46003688575821, 449.97811750815856, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 636.5242833068227, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 664.0699741247166, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 154.26555177408932, 41.46003688575821, 41.46003688575821, 87.54126927811751, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 46.79348218716088, 41.46003688575821, 41.46003688575821, 256.6621442369849, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 676.9384742060644, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 641.6850907297172, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 721.6220966848679, 41.46003688575821, 41.46003688575821, 172.15568041127943, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 690.710893564601, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 609.524361043414, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 283.12586490902163, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 722.1682369158899, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 572.1464065705588, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 238.6523214443456, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 586.0569143275272, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 568.612880200151, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 595.7813846702221, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 626.5294948866427, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 125.49417609774645, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 440.8116776548577, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 579.8424727391641, 593.2474606245521, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 652.6366007556159, 41.46003688575821, 41.46003688575821, 41.46003688575821, 635.14200488401, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 517.5688650289633, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 711.9250123354864, 378.470594465879, 41.46003688575821, 41.46003688575821, 561.7395694668361, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 404.3520467787575, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 593.7335713404357, 551.2590447510147, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 348.510959932911, 41.46003688575821, 41.46003688575821, 41.46003688575821, 210.90258140326853, 41.46003688575821, 41.46003688575821, 41.46003688575821, 198.08809280168, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 535.1085095777486, 41.46003688575821, 650.707331355, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 687.6214476641376, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 701.4911549200593, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 613.4596035366673, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 206.8805562432108, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 671.7738610604864, 41.46003688575821, 570.1345074318122, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 39.95062503755503, 41.46003688575821, 41.46003688575821, 650.551412340392, 41.46003688575821, 704.6548701581346, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 357.123784574356, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 634.3480639714559, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 626.6815486001725, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 651.8128178253714, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 41.46003688575821, 610.9941922189597, 41.46003688575821, 41.46003688575821]


# add prediction & win count keys to games dict
for i in range(len(games)):
    games[i]['HomePctProj'] = "-"
    games[i]['HomePdProj'] = "-"

for i in range(len(names)):
    names[i]['LeagueWins'] = 0
    names[i]['SCWins'] = 0
    names[i]['LeagueWinsFuture'] = 0
    names[i]['SCWinsFuture'] = 0
    names[i]['LeagueWinsProj'] = 0
    names[i]['SCWinsProj'] = 0



absFreq = []
cappedPd = []

# cap PD at 60
for i in range(len(games)):
    if games[i]['HomeScore'] == '-':
        cappedPd.append(0)   
    elif abs(int(games[i]['HomeScore']) - int(games[i]['AwayScore'])) > 60:
        cappedPd.append(int(60 * math.copysign(1,int(games[i]['HomeScore']) - int(games[i]['AwayScore']))))
    elif abs(int(games[i]['HomeScore']) - int(games[i]['AwayScore'])) > 0:
        cappedPd.append(int(games[i]['HomeScore']) - int(games[i]['AwayScore']))
        


homeBot = []
visitingBot = []
humanGame = []


# tabulate current season MoV distro of human v human official games
for j in range(len(games)):
    homeBot.append(games[j]['HomeBot'])
    visitingBot.append(games[j]['VisitingBot'])

                                
for j in range(len(games)):
    if int(games[j]['TypeDB']) in typeDbOfficial:
                humanGame.append(int(not(homeBot[j])) * int(not(visitingBot[j])))
 
    
for i in range(1,61):
    absFreq.append(0)
    
for j in range(len(games)):
    if int(games[j]['HomeBot']) == 1 or int(games[j]['VisitingBot']) == 1:
        continue
    for i in range(1,61):
            if abs(cappedPd[j]) == i and int(games[j]['TypeDB']) in typeDbOfficial:
                    absFreq[i-1] += 1
                    break
           
   
# combine current and past seasons' MoV into weighted average
currMov = []
seasonRawMov = []
seasonMov = []
seasonWinShares = []

# check list of games played is not empty

if sum(absFreq) != 0:

    for i in range(0,60):
        seasonRawMov.append(absFreq[i] / sum(absFreq))
        seasonMov.append(sum(seasonRawMov))
        seasonWinShares.append((1 + seasonMov[i]) / 2)
    
    for i in range(0,60):
        currMov.append((seasonWinShares[i] + 0.9 * oldMov[i]) / 1.9)

else:
    
    currMov = oldMov

# build prediction Elo table

currMovProjections = []
currMovProjections.append((0.5 + currMov[0]) / 2)

for i in range(1,59):
    currMovProjections.append((currMov[i-1] +  currMov[i]) / 2)
currMovProjections.append((3 + currMov[58]) / 4)


# initialize Elo parameters
K = 16
sigma = 100
mu = 100

def eloProb(sigma, homeElo, awayElo):
    return 1 / (1 + (10 ** ((awayElo - homeElo) / sigma)))


# =============================================================================
# # process new games one by one
# 
# =============================================================================

for i in range(len(games)):
    
    # parse date format
    games[i]['KickoffDate'] = datetime.date(int(games[i]['KickoffDate'][0:4]),int(games[i]['KickoffDate'][5:7]),int(games[i]['KickoffDate'][8:10]))
    
    
    # parse TeamIds
    if int(games[i]['HomeTeamID']) < 5000:
        homeTeamIndex = int(games[i]['HomeTeamID']) - 3007
    else:
        homeTeamIndex = int(games[i]['HomeTeamID']) - 99998209
            
    if int(games[i]['AwayTeamID']) < 5000:
        awayTeamIndex = int(games[i]['AwayTeamID']) - 3007
    else:
        awayTeamIndex = int(games[i]['AwayTeamID']) - 99998209
    
    
    # update win counters
    if not(games[i]['HomeScore'] == "-"):
        if int(games[i]['TypeDB']) == 1:
            if int(games[i]['HomeScore']) > int(games[i]['AwayScore']):
                names[homeTeamIndex]['LeagueWins'] += 1
            elif int(games[i]['HomeScore']) < int(games[i]['AwayScore']):
                names[awayTeamIndex]['LeagueWins'] += 1
                
        if int(games[i]['TypeDB']) == 7:
            if int(games[i]['HomeScore']) > int(games[i]['AwayScore']):
                names[homeTeamIndex]['SCWins'] += 1
            elif int(games[i]['HomeScore']) < int(games[i]['AwayScore']):
                names[awayTeamIndex]['SCWins'] += 1      
    
    # skip games included in last update & non-official games
    if games[i]['KickoffDate'] <= lastEndDate or not(int(games[i]['TypeDB']) in typeDbOfficial):
        continue
    
    # skip unplayed games, make prediction instead
    
    if games[i]['HomeScore'] == "-":
        
        games[i]['HomePctProj'] = eloProb(sigma, ratings[homeTeamIndex], ratings[awayTeamIndex])
        
        if games[i]['HomePctProj'] > 0.5:
            games[i]['HomePdProj'] = bisect(currMovProjections , games[i]['HomePctProj'])
        else:
            games[i]['HomePdProj'] = (-1) * bisect(currMovProjections ,  1 - games[i]['HomePctProj'])
        
        # add PctProj to season-long win totals
        
        if games[i]['TypeDB'] == '1':
            names[homeTeamIndex]['LeagueWinsFuture'] += games[i]['HomePctProj']
            names[awayTeamIndex]['LeagueWinsFuture'] += (1 -games[i]['HomePctProj'] )
        elif games[i]['TypeDB'] == '7':
            names[homeTeamIndex]['SCWinsFuture'] += games[i]['HomePctProj']
            names[awayTeamIndex]['SCWinsFuture'] += (1 -games[i]['HomePctProj'] )
        
        continue
    
       
     # check for bot status, if so set rating to 0
    if games[i]['HomeBot'] == 1:
        ratings[homeTeamIndex] = 0
            
    if games[i]['VisitingBot'] == 1:
        ratings[awayTeamIndex] = 0
        
    # skip bot vs. bot games (AFTER dropping their rating)
    if  games[i]['HomeBot'] == 1 and games[i]['VisitingBot'] == 1:
        continue
        
            
     # build & compare homeWinProb
     
    homeWinProb = eloProb(sigma, ratings[homeTeamIndex], ratings[awayTeamIndex])
        
    if cappedPd[i] > 0:
        homeWinShares = currMov[abs(cappedPd[i]) - 1]
    else:
        homeWinShares = 1 -  currMov[abs(cappedPd[i]) - 1]
        
    homeWinSharesDiff = homeWinShares - homeWinProb
    ratingChange = K * homeWinSharesDiff
        
        # update ratings
    if games[i]['HomeBot'] != 1:
        ratings[homeTeamIndex] += ratingChange
                   
    if games[i]['VisitingBot'] != 1:
        ratings[awayTeamIndex] -= ratingChange
        
    
            
#Reset average after processing new games
    
ratingsAvg = sum(ratings)/len(ratings)
for j in range(len(ratings)):
    ratings[j] += (mu - ratingsAvg)


# combine actual and future win totals

for i in range(len(names)):
    names[i]['LeagueWinsProj'] = names[i]['LeagueWins'] + names[i]['LeagueWinsFuture']
    names[i]['SCWinsProj'] = names[i]['SCWins'] + names[i]['SCWinsFuture']

      
# build regional totals
      
regions = []
SCDivisions = []

for i in range(0,9):
    regions.append({'HumanTeams': 0, 'HumanRatingSum': 0})

regions[0]['Name'] = 'Elite'
regions[1]['Name'] = 'Admirals'
regions[2]['Name'] = 'Claymore'
regions[3]['Name'] = 'Dragons'
regions[4]['Name'] = 'Fire'
regions[5]['Name'] = 'Galaxy'
regions[6]['Name'] = 'Monarchs'
regions[7]['Name'] = 'Sea Devils'
regions[8]['Name'] = 'Thunder'

for i in range(0,34):
    SCDivisions.append({'DivisionNumber': (i + 1), 'HumanTeams': 0, 'HumanRatingSum': 0})
    
for i in range(len(names)):
    
    # skip bots
    if int(names[i]['isBot']) == 1:
        continue
    
    # count stats for teams in their respective regions (League level 1)
    if int(names[i]['Leaguelevel']) == 0:
        regions[0]['HumanTeams'] += 1
        regions[0]['HumanRatingSum'] += ratings[i]
    elif int(names[i]['Leaguelevel']) == 1:
        if names[i]['Region'] == 'Admirals':
            regions[1]['HumanTeams'] += 1
            regions[1]['HumanRatingSum'] += ratings[i]
        elif names[i]['Region'] == 'Claymore':
            regions[2]['HumanTeams'] += 1
            regions[2]['HumanRatingSum'] += ratings[i]
        elif names[i]['Region'] == 'Dragons':
            regions[3]['HumanTeams'] += 1
            regions[3]['HumanRatingSum'] += ratings[i]
        elif names[i]['Region'] == 'Fire':
            regions[4]['HumanTeams'] += 1
            regions[4]['HumanRatingSum'] += ratings[i]
        elif names[i]['Region'] == 'Galaxy':
            regions[5]['HumanTeams'] += 1
            regions[5]['HumanRatingSum'] += ratings[i]
        elif names[i]['Region'] == 'Monarchs':
            regions[6]['HumanTeams'] += 1
            regions[6]['HumanRatingSum'] += ratings[i]
        elif names[i]['Region'] == 'Sea Devils':
            regions[7]['HumanTeams'] += 1
            regions[7]['HumanRatingSum'] += ratings[i]
        elif names[i]['Region'] == 'Thunder':
            regions[8]['HumanTeams'] += 1
            regions[8]['HumanRatingSum'] += ratings[i]
  
        # count stats for teams in their respective SC divisions
        
    for j in range(len(SCDivisions)):
        if int(names[i]['SupercupDivision']) == (j + 1):
            SCDivisions[j]['HumanTeams'] += 1
            SCDivisions[j]['HumanRatingSum'] += ratings[i]

# compute regional/divisonal averages

for i in range(len(regions)):
    regions[i]['HumanAvg'] = regions[i]['HumanRatingSum'] / regions[i]['HumanTeams']
    
for i in range(len(SCDivisions)):
    SCDivisions[i]['HumanAvg'] = SCDivisions[i]['HumanRatingSum'] / SCDivisions[i]['HumanTeams']
    
# append ratings into names dict

for i in range(len(names)):
    names[i]['Rating'] = ratings[i]
    
    
# generate Excel-friendly lists

leagueWinsProj = []
SCWinsProj = []
leagueDivision = []
for i in range(len(names)):
    leagueWinsProj.append(names[i]['LeagueWinsProj'])
    SCWinsProj.append(names[i]['SCWinsProj'])
    leagueDivision.append(names[i]['LeagueDivision'])
    

print('Game update finished!')


### Monte Carlo analysis ###

# =============================================================================
# 
# # initialize list of unplayed games
# 
# unplayedIndices = []
# 
# for j in range(len(games)):
#     
#     # check if game unplayed
#     if games['HomeScore'] != '-':
#         continue
# 
#     unplayedIndices.append(j)
# 
# # simulate entire season at a time
#     
# simulationDepth = 1000
# 
# for i in range(len(simulationDepth)):
#     
#     for j in unplayedIndices:
#         
#         #generate random number between 0 and 1, compare to homeWinProb
#         
#         coinFlip = random()
#         if float(games[j]['HomePctProj']) > coinFlip:
#             games[j]['Sim ' + (j + 1)] = 1
#         else:
#             games[j]['Sim ' + (j + 1)] = 0
#     
#     # sum actual wins + MC wins
#     
#     for n in range(len(names)):
#         
#         names[j]['LeagueWinsMC'] = 0
#         names[j]['SCWinsMC'] = 0
#         
#         for j in range(len(games)):
#             if j in unplayedIndices:
#                 if games[j]['TypeDB'] == 1:
#                     names[j]['LeagueWinsMC'] += 
#             else:
# =============================================================================
                
                

        